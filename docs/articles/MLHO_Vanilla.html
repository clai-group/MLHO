<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="mlho">
<title>MLHO Vanilla • mlho</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="MLHO Vanilla">
<meta property="og:description" content="mlho">
<meta property="og:image" content="/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">mlho</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.1</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/MLHO_Vanilla.html">MLHO Vanilla</a>
    <a class="dropdown-item" href="../articles/MLHO_for_PheWAS.html">Multivariate PheWAS with MLHO</a>
  </div>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/clai-group/MLHO/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">



<script src="MLHO_Vanilla_files/htmlwidgets-1.6.4/htmlwidgets.js"></script><link href="MLHO_Vanilla_files/datatables-css-0.0.0/datatables-crosstalk.css" rel="stylesheet">
<script src="MLHO_Vanilla_files/datatables-binding-0.32/datatables.js"></script><link href="MLHO_Vanilla_files/dt-core-1.13.6/css/jquery.dataTables.min.css" rel="stylesheet">
<link href="MLHO_Vanilla_files/dt-core-1.13.6/css/jquery.dataTables.extra.css" rel="stylesheet">
<script src="MLHO_Vanilla_files/dt-core-1.13.6/js/jquery.dataTables.min.js"></script><link href="MLHO_Vanilla_files/nouislider-7.0.10/jquery.nouislider.min.css" rel="stylesheet">
<script src="MLHO_Vanilla_files/nouislider-7.0.10/jquery.nouislider.min.js"></script><link href="MLHO_Vanilla_files/selectize-0.12.0/selectize.bootstrap3.css" rel="stylesheet">
<script src="MLHO_Vanilla_files/selectize-0.12.0/selectize.min.js"></script><link href="MLHO_Vanilla_files/crosstalk-1.2.1/css/crosstalk.min.css" rel="stylesheet">
<script src="MLHO_Vanilla_files/crosstalk-1.2.1/js/crosstalk.min.js"></script><div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>MLHO Vanilla</h1>
                        <h4 data-toc-skip class="author">Hossein Estiri,
Jiazi Tian</h4>
            
            <h4 data-toc-skip class="date">Mar. 5th 2024</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/clai-group/MLHO/blob/HEAD/vignettes/MLHO_Vanilla.Rmd" class="external-link"><code>vignettes/MLHO_Vanilla.Rmd</code></a></small>
      <div class="d-none name"><code>MLHO_Vanilla.Rmd</code></div>
    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># make sure the package is installed --&gt; devtools::install_github("hestiri/mlho")</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/clai-group/MLHO" class="external-link">mlho</a></span><span class="op">)</span></span></code></pre></div>
<p>Install and load the required packages:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw">if</span><span class="op">(</span><span class="op">!</span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">require</a></span><span class="op">(</span><span class="va"><a href="https://github.com/trinker/pacman" class="external-link">pacman</a></span><span class="op">)</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="st">"pacman"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Loading required package: pacman</span></span>
<span></span>
<span><span class="fu">pacman</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/pacman/man/p_load.html" class="external-link">p_load</a></span><span class="op">(</span><span class="va">data.table</span>, <span class="va">devtools</span>, <span class="va">backports</span>, <span class="va">Hmisc</span>, <span class="va">tidyr</span>,<span class="va">dplyr</span>,<span class="va">ggplot2</span>,<span class="va">plyr</span>,<span class="va">scales</span>,<span class="va">readr</span>,</span>
<span>               <span class="va">httr</span>, <span class="va">DT</span>, <span class="va">lubridate</span>, <span class="va">tidyverse</span>,<span class="va">reshape2</span>,<span class="va">foreach</span>,<span class="va">doParallel</span>,<span class="va">caret</span>,<span class="va">gbm</span>,<span class="va">lubridate</span>,<span class="va">praznik</span>, <span class="va">DALEX</span><span class="op">)</span></span></code></pre></div>
<div class="section level2">
<h2 id="mlho-vanilla-implementation">MLHO Vanilla implementation<a class="anchor" aria-label="anchor" href="#mlho-vanilla-implementation"></a>
</h2>
<p>Here we go through the vanilla implementation of MLHO using the
synthetic data provided in the package.</p>
<p>The synthetic data <code>syntheticmass</code> downloaded and prepared
according to MLHO input data model from <a href="https://synthea.mitre.org/downloads" class="external-link">SyntheticMass</a>, generated
by <a href="https://synthetichealth.github.io/synthea/" class="external-link">SyntheaTM</a>,
an open-source patient population simulation made available by <a href="https://health.mitre.org/" class="external-link">The MITRE Corporation</a>.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"syntheticmass"</span><span class="op">)</span></span></code></pre></div>
<p>here’s how <code>dbmart</code> table looks (there’s an extra column
that is the translation of the <code>phenx</code> concepts):</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">dbmart</span><span class="op">)</span></span>
<span><span class="co">#&gt;                            patient_num     phenx</span></span>
<span><span class="co">#&gt; 1 8d4c4326-e9de-4f45-9a4c-f8c36bff89ae 169553002</span></span>
<span><span class="co">#&gt; 2 10339b10-3cd1-4ac3-ac13-ec26728cb592 430193006</span></span>
<span><span class="co">#&gt; 3 f5dcd418-09fe-4a2f-baa0-3da800bd8c3a 430193006</span></span>
<span><span class="co">#&gt; 4 f5dcd418-09fe-4a2f-baa0-3da800bd8c3a 117015009</span></span>
<span><span class="co">#&gt; 5 f5dcd418-09fe-4a2f-baa0-3da800bd8c3a 117015009</span></span>
<span><span class="co">#&gt; 6 f5dcd418-09fe-4a2f-baa0-3da800bd8c3a 430193006</span></span>
<span><span class="co">#&gt;                               DESCRIPTION          start_date</span></span>
<span><span class="co">#&gt; 1 Insertion of subcutaneous contraceptive 2011-04-30 00:26:23</span></span>
<span><span class="co">#&gt; 2   Medication Reconciliation (procedure) 2010-07-27 12:58:08</span></span>
<span><span class="co">#&gt; 3   Medication Reconciliation (procedure) 2010-11-20 03:04:34</span></span>
<span><span class="co">#&gt; 4              Throat culture (procedure) 2011-02-07 03:04:34</span></span>
<span><span class="co">#&gt; 5              Throat culture (procedure) 2011-04-19 03:04:34</span></span>
<span><span class="co">#&gt; 6   Medication Reconciliation (procedure) 2011-11-26 03:04:34</span></span></code></pre></div>
<p>our demographic table contains: patient_num, white, black, hispanic,
sex_cd.</p>
<p>##split data into train-test</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">uniqpats</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">dbmart</span><span class="op">$</span><span class="va">patient_num</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#using a 70-30 ratio</span></span>
<span><span class="va">test_ind</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="va">uniqpats</span>,</span>
<span>                   <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="fl">.3</span><span class="op">*</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">uniqpats</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">test_labels</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">labeldt</span>,<span class="va">labeldt</span><span class="op">$</span><span class="va">patient_num</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">test_ind</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="st">"test set lables:"</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "test set lables:"</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="va">test_labels</span><span class="op">$</span><span class="va">label</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;   0   1 </span></span>
<span><span class="co">#&gt; 261  90</span></span>
<span><span class="va">train_labels</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">labeldt</span>,<span class="op">!</span><span class="op">(</span><span class="va">labeldt</span><span class="op">$</span><span class="va">patient_num</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">test_ind</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="st">"train set lables:"</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "train set lables:"</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="va">train_labels</span><span class="op">$</span><span class="va">label</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;   0   1 </span></span>
<span><span class="co">#&gt; 593 227</span></span>
<span><span class="co"># train and test sets </span></span>
<span><span class="va">dat.train</span>  <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">dbmart</span>,<span class="op">!</span><span class="op">(</span><span class="va">dbmart</span><span class="op">$</span><span class="va">patient_num</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">test_ind</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">dat.test</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">dbmart</span>,<span class="va">dbmart</span><span class="op">$</span><span class="va">patient_num</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">test_ind</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>now dimensionality reduction on training set ## MSMR lite from here,
we will split the data into a train and a test set and apply
<code>MSMR.lite</code> to the training data</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">data.table</span><span class="fu">::</span><span class="fu"><a href="https://rdatatable.gitlab.io/data.table/reference/setDT.html" class="external-link">setDT</a></span><span class="op">(</span><span class="va">dat.train</span><span class="op">)</span></span>
<span><span class="va">dat.train</span><span class="op">[</span>,<span class="va">row</span> <span class="op">:=</span> <span class="va">.I</span><span class="op">]</span></span>
<span><span class="va">dat.train</span><span class="op">$</span><span class="va">value.var</span> <span class="op">&lt;-</span> <span class="fl">1</span></span>
<span><span class="va">uniqpats.train</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">dat.train</span><span class="op">$</span><span class="va">patient_num</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co">##here is the application of MSMR.lite</span></span>
<span><span class="va">dat.train</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/MSMR.lite.html">MSMR.lite</a></span><span class="op">(</span>MLHO.dat<span class="op">=</span><span class="va">dat.train</span>,</span>
<span>                        patients <span class="op">=</span> <span class="va">uniqpats.train</span>,</span>
<span>                        sparsity<span class="op">=</span><span class="fl">0.005</span>, </span>
<span>                        labels <span class="op">=</span> <span class="va">labeldt</span>,</span>
<span>                        topn<span class="op">=</span><span class="fl">200</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "step - 1: sparsity screening!"</span></span>
<span><span class="co">#&gt; [1] "step 2: JMI dimensionality reduction!"</span></span></code></pre></div>
<p>Notice that we are removing concepts that had prevalence less than
0.5% and then only taking the top 200 after the JMI rankings. See help
(<code><a href="../reference/MSMR.lite.html">?mlho::MSMR.lite</a></code>) for <code>MSMR.lite</code>
parameters.</p>
<p>Now we have the training data with the top 200 features, to which we
can add demographic features. Now on to prepping the test set:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dat.test</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">dat.test</span>,<span class="va">dat.test</span><span class="op">$</span><span class="va">phenx</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">dat.train</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu">setDT</span><span class="op">(</span><span class="va">dat.test</span><span class="op">)</span></span>
<span><span class="va">dat.test</span><span class="op">[</span>,<span class="va">row</span> <span class="op">:=</span> <span class="va">.I</span><span class="op">]</span></span>
<span><span class="va">dat.test</span><span class="op">$</span><span class="va">value.var</span> <span class="op">&lt;-</span> <span class="fl">1</span></span>
<span><span class="va">uniqpats.test</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">dat.test</span><span class="op">$</span><span class="va">patient_num</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">dat.test</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/MSMR.lite.html">MSMR.lite</a></span><span class="op">(</span>MLHO.dat<span class="op">=</span><span class="va">dat.test</span>,patients <span class="op">=</span> <span class="va">uniqpats.test</span>,sparsity<span class="op">=</span><span class="cn">NA</span>,jmi <span class="op">=</span> <span class="cn">FALSE</span>,labels <span class="op">=</span> <span class="va">labeldt</span><span class="op">)</span></span></code></pre></div>
<p>Here notice that we only used <code>MSMR.lite</code> to generate the
wide table that matches to the <code>dat.train</code> table.</p>
<p>##Modeling we will use the <code>mlearn</code> function to do the
modeling, which includes training the model and testing it on the test
set.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">model.test</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/mlearn.html">mlearn</a></span><span class="op">(</span><span class="va">dat.train</span>,</span>
<span>                   <span class="va">dat.test</span>,</span>
<span>                   dems<span class="op">=</span><span class="va">dems</span>,</span>
<span>                   save.model<span class="op">=</span><span class="cn">FALSE</span>,</span>
<span>                   classifier<span class="op">=</span><span class="st">"gbm"</span>,</span>
<span>                   note<span class="op">=</span><span class="st">"mlho_terst_run"</span>,</span>
<span>                   cv<span class="op">=</span><span class="st">"cv"</span>,</span>
<span>                   nfold<span class="op">=</span><span class="fl">5</span>,</span>
<span>                   aoi<span class="op">=</span><span class="st">"prediabetes"</span>,</span>
<span>                   multicore<span class="op">=</span><span class="cn">FALSE</span>,</span>
<span>                   calSHAP <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "the modeling!"</span></span>
<span><span class="co">#&gt; Iter   TrainDeviance   ValidDeviance   StepSize   Improve</span></span>
<span><span class="co">#&gt;      1        1.0721             nan     0.1000    0.0528</span></span>
<span><span class="co">#&gt;      2        0.9872             nan     0.1000    0.0390</span></span>
<span><span class="co">#&gt;      3        0.9256             nan     0.1000    0.0316</span></span>
<span><span class="co">#&gt;      4        0.8717             nan     0.1000    0.0266</span></span>
<span><span class="co">#&gt;      5        0.8291             nan     0.1000    0.0205</span></span>
<span><span class="co">#&gt;      6        0.7951             nan     0.1000    0.0169</span></span>
<span><span class="co">#&gt;      7        0.7667             nan     0.1000    0.0140</span></span>
<span><span class="co">#&gt;      8        0.7457             nan     0.1000    0.0121</span></span>
<span><span class="co">#&gt;      9        0.7256             nan     0.1000    0.0100</span></span>
<span><span class="co">#&gt;     10        0.7085             nan     0.1000    0.0085</span></span>
<span><span class="co">#&gt;     20        0.6163             nan     0.1000    0.0024</span></span>
<span><span class="co">#&gt;     40        0.5363             nan     0.1000    0.0005</span></span>
<span><span class="co">#&gt;     60        0.4973             nan     0.1000    0.0003</span></span>
<span><span class="co">#&gt;     80        0.4702             nan     0.1000   -0.0000</span></span>
<span><span class="co">#&gt;    100        0.4476             nan     0.1000   -0.0013</span></span>
<span><span class="co">#&gt;    120        0.4262             nan     0.1000   -0.0008</span></span>
<span><span class="co">#&gt;    140        0.4135             nan     0.1000   -0.0011</span></span>
<span><span class="co">#&gt;    150        0.4063             nan     0.1000   -0.0004</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Iter   TrainDeviance   ValidDeviance   StepSize   Improve</span></span>
<span><span class="co">#&gt;      1        1.0582             nan     0.1000    0.0554</span></span>
<span><span class="co">#&gt;      2        0.9733             nan     0.1000    0.0430</span></span>
<span><span class="co">#&gt;      3        0.9079             nan     0.1000    0.0332</span></span>
<span><span class="co">#&gt;      4        0.8545             nan     0.1000    0.0272</span></span>
<span><span class="co">#&gt;      5        0.8045             nan     0.1000    0.0230</span></span>
<span><span class="co">#&gt;      6        0.7650             nan     0.1000    0.0183</span></span>
<span><span class="co">#&gt;      7        0.7382             nan     0.1000    0.0129</span></span>
<span><span class="co">#&gt;      8        0.7121             nan     0.1000    0.0124</span></span>
<span><span class="co">#&gt;      9        0.6852             nan     0.1000    0.0113</span></span>
<span><span class="co">#&gt;     10        0.6631             nan     0.1000    0.0099</span></span>
<span><span class="co">#&gt;     20        0.5478             nan     0.1000    0.0025</span></span>
<span><span class="co">#&gt;     40        0.4538             nan     0.1000    0.0009</span></span>
<span><span class="co">#&gt;     60        0.4097             nan     0.1000   -0.0009</span></span>
<span><span class="co">#&gt;     80        0.3759             nan     0.1000   -0.0003</span></span>
<span><span class="co">#&gt;    100        0.3531             nan     0.1000   -0.0010</span></span>
<span><span class="co">#&gt;    120        0.3317             nan     0.1000   -0.0000</span></span>
<span><span class="co">#&gt;    140        0.3187             nan     0.1000   -0.0002</span></span>
<span><span class="co">#&gt;    150        0.3119             nan     0.1000   -0.0018</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Iter   TrainDeviance   ValidDeviance   StepSize   Improve</span></span>
<span><span class="co">#&gt;      1        1.0704             nan     0.1000    0.0601</span></span>
<span><span class="co">#&gt;      2        0.9735             nan     0.1000    0.0469</span></span>
<span><span class="co">#&gt;      3        0.9016             nan     0.1000    0.0342</span></span>
<span><span class="co">#&gt;      4        0.8454             nan     0.1000    0.0297</span></span>
<span><span class="co">#&gt;      5        0.7962             nan     0.1000    0.0226</span></span>
<span><span class="co">#&gt;      6        0.7509             nan     0.1000    0.0196</span></span>
<span><span class="co">#&gt;      7        0.7127             nan     0.1000    0.0163</span></span>
<span><span class="co">#&gt;      8        0.6819             nan     0.1000    0.0150</span></span>
<span><span class="co">#&gt;      9        0.6553             nan     0.1000    0.0111</span></span>
<span><span class="co">#&gt;     10        0.6284             nan     0.1000    0.0106</span></span>
<span><span class="co">#&gt;     20        0.5026             nan     0.1000    0.0021</span></span>
<span><span class="co">#&gt;     40        0.4142             nan     0.1000   -0.0004</span></span>
<span><span class="co">#&gt;     60        0.3641             nan     0.1000   -0.0001</span></span>
<span><span class="co">#&gt;     80        0.3306             nan     0.1000   -0.0014</span></span>
<span><span class="co">#&gt;    100        0.3033             nan     0.1000   -0.0012</span></span>
<span><span class="co">#&gt;    120        0.2817             nan     0.1000   -0.0011</span></span>
<span><span class="co">#&gt;    140        0.2663             nan     0.1000   -0.0007</span></span>
<span><span class="co">#&gt;    150        0.2564             nan     0.1000   -0.0007</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Iter   TrainDeviance   ValidDeviance   StepSize   Improve</span></span>
<span><span class="co">#&gt;      1        1.0637             nan     0.1000    0.0571</span></span>
<span><span class="co">#&gt;      2        0.9826             nan     0.1000    0.0414</span></span>
<span><span class="co">#&gt;      3        0.9181             nan     0.1000    0.0333</span></span>
<span><span class="co">#&gt;      4        0.8659             nan     0.1000    0.0269</span></span>
<span><span class="co">#&gt;      5        0.8190             nan     0.1000    0.0227</span></span>
<span><span class="co">#&gt;      6        0.7827             nan     0.1000    0.0185</span></span>
<span><span class="co">#&gt;      7        0.7500             nan     0.1000    0.0149</span></span>
<span><span class="co">#&gt;      8        0.7284             nan     0.1000    0.0132</span></span>
<span><span class="co">#&gt;      9        0.7068             nan     0.1000    0.0106</span></span>
<span><span class="co">#&gt;     10        0.6884             nan     0.1000    0.0091</span></span>
<span><span class="co">#&gt;     20        0.6033             nan     0.1000    0.0000</span></span>
<span><span class="co">#&gt;     40        0.5314             nan     0.1000   -0.0006</span></span>
<span><span class="co">#&gt;     60        0.4912             nan     0.1000    0.0001</span></span>
<span><span class="co">#&gt;     80        0.4713             nan     0.1000   -0.0004</span></span>
<span><span class="co">#&gt;    100        0.4501             nan     0.1000   -0.0004</span></span>
<span><span class="co">#&gt;    120        0.4299             nan     0.1000   -0.0009</span></span>
<span><span class="co">#&gt;    140        0.4169             nan     0.1000    0.0004</span></span>
<span><span class="co">#&gt;    150        0.4097             nan     0.1000   -0.0005</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Iter   TrainDeviance   ValidDeviance   StepSize   Improve</span></span>
<span><span class="co">#&gt;      1        1.0663             nan     0.1000    0.0589</span></span>
<span><span class="co">#&gt;      2        0.9718             nan     0.1000    0.0438</span></span>
<span><span class="co">#&gt;      3        0.8973             nan     0.1000    0.0342</span></span>
<span><span class="co">#&gt;      4        0.8388             nan     0.1000    0.0288</span></span>
<span><span class="co">#&gt;      5        0.7906             nan     0.1000    0.0229</span></span>
<span><span class="co">#&gt;      6        0.7500             nan     0.1000    0.0187</span></span>
<span><span class="co">#&gt;      7        0.7174             nan     0.1000    0.0166</span></span>
<span><span class="co">#&gt;      8        0.6879             nan     0.1000    0.0130</span></span>
<span><span class="co">#&gt;      9        0.6642             nan     0.1000    0.0093</span></span>
<span><span class="co">#&gt;     10        0.6449             nan     0.1000    0.0089</span></span>
<span><span class="co">#&gt;     20        0.5255             nan     0.1000    0.0016</span></span>
<span><span class="co">#&gt;     40        0.4490             nan     0.1000    0.0005</span></span>
<span><span class="co">#&gt;     60        0.4075             nan     0.1000   -0.0018</span></span>
<span><span class="co">#&gt;     80        0.3806             nan     0.1000   -0.0011</span></span>
<span><span class="co">#&gt;    100        0.3605             nan     0.1000   -0.0012</span></span>
<span><span class="co">#&gt;    120        0.3400             nan     0.1000    0.0001</span></span>
<span><span class="co">#&gt;    140        0.3246             nan     0.1000   -0.0010</span></span>
<span><span class="co">#&gt;    150        0.3184             nan     0.1000   -0.0006</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Iter   TrainDeviance   ValidDeviance   StepSize   Improve</span></span>
<span><span class="co">#&gt;      1        1.0537             nan     0.1000    0.0615</span></span>
<span><span class="co">#&gt;      2        0.9639             nan     0.1000    0.0448</span></span>
<span><span class="co">#&gt;      3        0.8878             nan     0.1000    0.0345</span></span>
<span><span class="co">#&gt;      4        0.8277             nan     0.1000    0.0284</span></span>
<span><span class="co">#&gt;      5        0.7796             nan     0.1000    0.0246</span></span>
<span><span class="co">#&gt;      6        0.7364             nan     0.1000    0.0175</span></span>
<span><span class="co">#&gt;      7        0.6977             nan     0.1000    0.0160</span></span>
<span><span class="co">#&gt;      8        0.6659             nan     0.1000    0.0138</span></span>
<span><span class="co">#&gt;      9        0.6410             nan     0.1000    0.0107</span></span>
<span><span class="co">#&gt;     10        0.6206             nan     0.1000    0.0094</span></span>
<span><span class="co">#&gt;     20        0.4927             nan     0.1000    0.0022</span></span>
<span><span class="co">#&gt;     40        0.4062             nan     0.1000   -0.0003</span></span>
<span><span class="co">#&gt;     60        0.3625             nan     0.1000   -0.0016</span></span>
<span><span class="co">#&gt;     80        0.3334             nan     0.1000   -0.0011</span></span>
<span><span class="co">#&gt;    100        0.3095             nan     0.1000   -0.0007</span></span>
<span><span class="co">#&gt;    120        0.2877             nan     0.1000   -0.0015</span></span>
<span><span class="co">#&gt;    140        0.2717             nan     0.1000   -0.0011</span></span>
<span><span class="co">#&gt;    150        0.2644             nan     0.1000   -0.0010</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Iter   TrainDeviance   ValidDeviance   StepSize   Improve</span></span>
<span><span class="co">#&gt;      1        1.0661             nan     0.1000    0.0587</span></span>
<span><span class="co">#&gt;      2        0.9818             nan     0.1000    0.0440</span></span>
<span><span class="co">#&gt;      3        0.9120             nan     0.1000    0.0333</span></span>
<span><span class="co">#&gt;      4        0.8590             nan     0.1000    0.0283</span></span>
<span><span class="co">#&gt;      5        0.8127             nan     0.1000    0.0226</span></span>
<span><span class="co">#&gt;      6        0.7692             nan     0.1000    0.0181</span></span>
<span><span class="co">#&gt;      7        0.7391             nan     0.1000    0.0159</span></span>
<span><span class="co">#&gt;      8        0.7148             nan     0.1000    0.0132</span></span>
<span><span class="co">#&gt;      9        0.6930             nan     0.1000    0.0115</span></span>
<span><span class="co">#&gt;     10        0.6754             nan     0.1000    0.0097</span></span>
<span><span class="co">#&gt;     20        0.5846             nan     0.1000    0.0010</span></span>
<span><span class="co">#&gt;     40        0.5066             nan     0.1000    0.0012</span></span>
<span><span class="co">#&gt;     60        0.4652             nan     0.1000   -0.0002</span></span>
<span><span class="co">#&gt;     80        0.4353             nan     0.1000    0.0002</span></span>
<span><span class="co">#&gt;    100        0.4179             nan     0.1000    0.0002</span></span>
<span><span class="co">#&gt;    120        0.4029             nan     0.1000   -0.0003</span></span>
<span><span class="co">#&gt;    140        0.3900             nan     0.1000   -0.0020</span></span>
<span><span class="co">#&gt;    150        0.3821             nan     0.1000   -0.0005</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Iter   TrainDeviance   ValidDeviance   StepSize   Improve</span></span>
<span><span class="co">#&gt;      1        1.0657             nan     0.1000    0.0618</span></span>
<span><span class="co">#&gt;      2        0.9775             nan     0.1000    0.0436</span></span>
<span><span class="co">#&gt;      3        0.9004             nan     0.1000    0.0362</span></span>
<span><span class="co">#&gt;      4        0.8380             nan     0.1000    0.0272</span></span>
<span><span class="co">#&gt;      5        0.7841             nan     0.1000    0.0232</span></span>
<span><span class="co">#&gt;      6        0.7429             nan     0.1000    0.0193</span></span>
<span><span class="co">#&gt;      7        0.7055             nan     0.1000    0.0175</span></span>
<span><span class="co">#&gt;      8        0.6779             nan     0.1000    0.0139</span></span>
<span><span class="co">#&gt;      9        0.6548             nan     0.1000    0.0111</span></span>
<span><span class="co">#&gt;     10        0.6321             nan     0.1000    0.0103</span></span>
<span><span class="co">#&gt;     20        0.5101             nan     0.1000    0.0031</span></span>
<span><span class="co">#&gt;     40        0.4295             nan     0.1000   -0.0018</span></span>
<span><span class="co">#&gt;     60        0.3870             nan     0.1000   -0.0016</span></span>
<span><span class="co">#&gt;     80        0.3540             nan     0.1000   -0.0010</span></span>
<span><span class="co">#&gt;    100        0.3345             nan     0.1000   -0.0014</span></span>
<span><span class="co">#&gt;    120        0.3137             nan     0.1000   -0.0008</span></span>
<span><span class="co">#&gt;    140        0.2966             nan     0.1000   -0.0008</span></span>
<span><span class="co">#&gt;    150        0.2925             nan     0.1000   -0.0017</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Iter   TrainDeviance   ValidDeviance   StepSize   Improve</span></span>
<span><span class="co">#&gt;      1        1.0526             nan     0.1000    0.0627</span></span>
<span><span class="co">#&gt;      2        0.9570             nan     0.1000    0.0461</span></span>
<span><span class="co">#&gt;      3        0.8797             nan     0.1000    0.0358</span></span>
<span><span class="co">#&gt;      4        0.8154             nan     0.1000    0.0290</span></span>
<span><span class="co">#&gt;      5        0.7688             nan     0.1000    0.0229</span></span>
<span><span class="co">#&gt;      6        0.7236             nan     0.1000    0.0203</span></span>
<span><span class="co">#&gt;      7        0.6853             nan     0.1000    0.0170</span></span>
<span><span class="co">#&gt;      8        0.6547             nan     0.1000    0.0141</span></span>
<span><span class="co">#&gt;      9        0.6281             nan     0.1000    0.0108</span></span>
<span><span class="co">#&gt;     10        0.6053             nan     0.1000    0.0112</span></span>
<span><span class="co">#&gt;     20        0.4739             nan     0.1000    0.0025</span></span>
<span><span class="co">#&gt;     40        0.3877             nan     0.1000   -0.0010</span></span>
<span><span class="co">#&gt;     60        0.3384             nan     0.1000   -0.0009</span></span>
<span><span class="co">#&gt;     80        0.3018             nan     0.1000   -0.0034</span></span>
<span><span class="co">#&gt;    100        0.2739             nan     0.1000   -0.0016</span></span>
<span><span class="co">#&gt;    120        0.2545             nan     0.1000   -0.0006</span></span>
<span><span class="co">#&gt;    140        0.2372             nan     0.1000   -0.0018</span></span>
<span><span class="co">#&gt;    150        0.2302             nan     0.1000   -0.0011</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Iter   TrainDeviance   ValidDeviance   StepSize   Improve</span></span>
<span><span class="co">#&gt;      1        1.0700             nan     0.1000    0.0551</span></span>
<span><span class="co">#&gt;      2        0.9756             nan     0.1000    0.0452</span></span>
<span><span class="co">#&gt;      3        0.9095             nan     0.1000    0.0353</span></span>
<span><span class="co">#&gt;      4        0.8497             nan     0.1000    0.0264</span></span>
<span><span class="co">#&gt;      5        0.8068             nan     0.1000    0.0220</span></span>
<span><span class="co">#&gt;      6        0.7691             nan     0.1000    0.0191</span></span>
<span><span class="co">#&gt;      7        0.7380             nan     0.1000    0.0159</span></span>
<span><span class="co">#&gt;      8        0.7091             nan     0.1000    0.0134</span></span>
<span><span class="co">#&gt;      9        0.6861             nan     0.1000    0.0107</span></span>
<span><span class="co">#&gt;     10        0.6662             nan     0.1000    0.0090</span></span>
<span><span class="co">#&gt;     20        0.5802             nan     0.1000    0.0028</span></span>
<span><span class="co">#&gt;     40        0.5065             nan     0.1000   -0.0014</span></span>
<span><span class="co">#&gt;     60        0.4675             nan     0.1000   -0.0002</span></span>
<span><span class="co">#&gt;     80        0.4420             nan     0.1000   -0.0013</span></span>
<span><span class="co">#&gt;    100        0.4206             nan     0.1000   -0.0009</span></span>
<span><span class="co">#&gt;    120        0.4011             nan     0.1000    0.0000</span></span>
<span><span class="co">#&gt;    140        0.3862             nan     0.1000   -0.0003</span></span>
<span><span class="co">#&gt;    150        0.3812             nan     0.1000   -0.0005</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Iter   TrainDeviance   ValidDeviance   StepSize   Improve</span></span>
<span><span class="co">#&gt;      1        1.0538             nan     0.1000    0.0572</span></span>
<span><span class="co">#&gt;      2        0.9610             nan     0.1000    0.0461</span></span>
<span><span class="co">#&gt;      3        0.8893             nan     0.1000    0.0353</span></span>
<span><span class="co">#&gt;      4        0.8345             nan     0.1000    0.0286</span></span>
<span><span class="co">#&gt;      5        0.7801             nan     0.1000    0.0264</span></span>
<span><span class="co">#&gt;      6        0.7425             nan     0.1000    0.0198</span></span>
<span><span class="co">#&gt;      7        0.7053             nan     0.1000    0.0184</span></span>
<span><span class="co">#&gt;      8        0.6706             nan     0.1000    0.0153</span></span>
<span><span class="co">#&gt;      9        0.6487             nan     0.1000    0.0112</span></span>
<span><span class="co">#&gt;     10        0.6257             nan     0.1000    0.0108</span></span>
<span><span class="co">#&gt;     20        0.5125             nan     0.1000    0.0006</span></span>
<span><span class="co">#&gt;     40        0.4355             nan     0.1000   -0.0024</span></span>
<span><span class="co">#&gt;     60        0.3941             nan     0.1000   -0.0019</span></span>
<span><span class="co">#&gt;     80        0.3611             nan     0.1000   -0.0014</span></span>
<span><span class="co">#&gt;    100        0.3349             nan     0.1000   -0.0016</span></span>
<span><span class="co">#&gt;    120        0.3154             nan     0.1000   -0.0013</span></span>
<span><span class="co">#&gt;    140        0.3011             nan     0.1000   -0.0014</span></span>
<span><span class="co">#&gt;    150        0.2949             nan     0.1000   -0.0016</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Iter   TrainDeviance   ValidDeviance   StepSize   Improve</span></span>
<span><span class="co">#&gt;      1        1.0573             nan     0.1000    0.0621</span></span>
<span><span class="co">#&gt;      2        0.9624             nan     0.1000    0.0463</span></span>
<span><span class="co">#&gt;      3        0.8811             nan     0.1000    0.0383</span></span>
<span><span class="co">#&gt;      4        0.8171             nan     0.1000    0.0292</span></span>
<span><span class="co">#&gt;      5        0.7685             nan     0.1000    0.0231</span></span>
<span><span class="co">#&gt;      6        0.7211             nan     0.1000    0.0225</span></span>
<span><span class="co">#&gt;      7        0.6805             nan     0.1000    0.0178</span></span>
<span><span class="co">#&gt;      8        0.6491             nan     0.1000    0.0132</span></span>
<span><span class="co">#&gt;      9        0.6232             nan     0.1000    0.0113</span></span>
<span><span class="co">#&gt;     10        0.5994             nan     0.1000    0.0100</span></span>
<span><span class="co">#&gt;     20        0.4711             nan     0.1000    0.0016</span></span>
<span><span class="co">#&gt;     40        0.3923             nan     0.1000   -0.0015</span></span>
<span><span class="co">#&gt;     60        0.3461             nan     0.1000   -0.0017</span></span>
<span><span class="co">#&gt;     80        0.3091             nan     0.1000   -0.0003</span></span>
<span><span class="co">#&gt;    100        0.2820             nan     0.1000   -0.0018</span></span>
<span><span class="co">#&gt;    120        0.2634             nan     0.1000   -0.0008</span></span>
<span><span class="co">#&gt;    140        0.2478             nan     0.1000   -0.0016</span></span>
<span><span class="co">#&gt;    150        0.2379             nan     0.1000   -0.0016</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Iter   TrainDeviance   ValidDeviance   StepSize   Improve</span></span>
<span><span class="co">#&gt;      1        1.0619             nan     0.1000    0.0582</span></span>
<span><span class="co">#&gt;      2        0.9711             nan     0.1000    0.0456</span></span>
<span><span class="co">#&gt;      3        0.8971             nan     0.1000    0.0364</span></span>
<span><span class="co">#&gt;      4        0.8401             nan     0.1000    0.0275</span></span>
<span><span class="co">#&gt;      5        0.7954             nan     0.1000    0.0231</span></span>
<span><span class="co">#&gt;      6        0.7565             nan     0.1000    0.0182</span></span>
<span><span class="co">#&gt;      7        0.7253             nan     0.1000    0.0158</span></span>
<span><span class="co">#&gt;      8        0.7033             nan     0.1000    0.0126</span></span>
<span><span class="co">#&gt;      9        0.6768             nan     0.1000    0.0104</span></span>
<span><span class="co">#&gt;     10        0.6579             nan     0.1000    0.0091</span></span>
<span><span class="co">#&gt;     20        0.5657             nan     0.1000    0.0012</span></span>
<span><span class="co">#&gt;     40        0.4950             nan     0.1000    0.0005</span></span>
<span><span class="co">#&gt;     60        0.4596             nan     0.1000   -0.0005</span></span>
<span><span class="co">#&gt;     80        0.4294             nan     0.1000    0.0001</span></span>
<span><span class="co">#&gt;    100        0.4054             nan     0.1000    0.0001</span></span>
<span><span class="co">#&gt;    120        0.3888             nan     0.1000   -0.0009</span></span>
<span><span class="co">#&gt;    140        0.3740             nan     0.1000   -0.0002</span></span>
<span><span class="co">#&gt;    150        0.3658             nan     0.1000    0.0001</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Iter   TrainDeviance   ValidDeviance   StepSize   Improve</span></span>
<span><span class="co">#&gt;      1        1.0620             nan     0.1000    0.0646</span></span>
<span><span class="co">#&gt;      2        0.9669             nan     0.1000    0.0490</span></span>
<span><span class="co">#&gt;      3        0.8863             nan     0.1000    0.0368</span></span>
<span><span class="co">#&gt;      4        0.8233             nan     0.1000    0.0290</span></span>
<span><span class="co">#&gt;      5        0.7734             nan     0.1000    0.0228</span></span>
<span><span class="co">#&gt;      6        0.7339             nan     0.1000    0.0191</span></span>
<span><span class="co">#&gt;      7        0.6984             nan     0.1000    0.0174</span></span>
<span><span class="co">#&gt;      8        0.6695             nan     0.1000    0.0145</span></span>
<span><span class="co">#&gt;      9        0.6451             nan     0.1000    0.0116</span></span>
<span><span class="co">#&gt;     10        0.6222             nan     0.1000    0.0110</span></span>
<span><span class="co">#&gt;     20        0.5025             nan     0.1000    0.0018</span></span>
<span><span class="co">#&gt;     40        0.4242             nan     0.1000   -0.0015</span></span>
<span><span class="co">#&gt;     60        0.3766             nan     0.1000   -0.0007</span></span>
<span><span class="co">#&gt;     80        0.3408             nan     0.1000   -0.0019</span></span>
<span><span class="co">#&gt;    100        0.3161             nan     0.1000   -0.0005</span></span>
<span><span class="co">#&gt;    120        0.2965             nan     0.1000   -0.0015</span></span>
<span><span class="co">#&gt;    140        0.2808             nan     0.1000   -0.0009</span></span>
<span><span class="co">#&gt;    150        0.2745             nan     0.1000   -0.0008</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Iter   TrainDeviance   ValidDeviance   StepSize   Improve</span></span>
<span><span class="co">#&gt;      1        1.0535             nan     0.1000    0.0649</span></span>
<span><span class="co">#&gt;      2        0.9562             nan     0.1000    0.0474</span></span>
<span><span class="co">#&gt;      3        0.8786             nan     0.1000    0.0371</span></span>
<span><span class="co">#&gt;      4        0.8181             nan     0.1000    0.0291</span></span>
<span><span class="co">#&gt;      5        0.7646             nan     0.1000    0.0239</span></span>
<span><span class="co">#&gt;      6        0.7176             nan     0.1000    0.0214</span></span>
<span><span class="co">#&gt;      7        0.6807             nan     0.1000    0.0160</span></span>
<span><span class="co">#&gt;      8        0.6481             nan     0.1000    0.0136</span></span>
<span><span class="co">#&gt;      9        0.6180             nan     0.1000    0.0126</span></span>
<span><span class="co">#&gt;     10        0.5950             nan     0.1000    0.0095</span></span>
<span><span class="co">#&gt;     20        0.4681             nan     0.1000    0.0015</span></span>
<span><span class="co">#&gt;     40        0.3774             nan     0.1000    0.0001</span></span>
<span><span class="co">#&gt;     60        0.3296             nan     0.1000   -0.0014</span></span>
<span><span class="co">#&gt;     80        0.2937             nan     0.1000   -0.0009</span></span>
<span><span class="co">#&gt;    100        0.2704             nan     0.1000   -0.0028</span></span>
<span><span class="co">#&gt;    120        0.2483             nan     0.1000   -0.0009</span></span>
<span><span class="co">#&gt;    140        0.2311             nan     0.1000   -0.0002</span></span>
<span><span class="co">#&gt;    150        0.2233             nan     0.1000   -0.0016</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Iter   TrainDeviance   ValidDeviance   StepSize   Improve</span></span>
<span><span class="co">#&gt;      1        1.0565             nan     0.1000    0.0553</span></span>
<span><span class="co">#&gt;      2        0.9672             nan     0.1000    0.0465</span></span>
<span><span class="co">#&gt;      3        0.8913             nan     0.1000    0.0368</span></span>
<span><span class="co">#&gt;      4        0.8304             nan     0.1000    0.0276</span></span>
<span><span class="co">#&gt;      5        0.7795             nan     0.1000    0.0242</span></span>
<span><span class="co">#&gt;      6        0.7363             nan     0.1000    0.0211</span></span>
<span><span class="co">#&gt;      7        0.6973             nan     0.1000    0.0171</span></span>
<span><span class="co">#&gt;      8        0.6692             nan     0.1000    0.0123</span></span>
<span><span class="co">#&gt;      9        0.6408             nan     0.1000    0.0126</span></span>
<span><span class="co">#&gt;     10        0.6183             nan     0.1000    0.0101</span></span>
<span><span class="co">#&gt;     20        0.4880             nan     0.1000    0.0035</span></span>
<span><span class="co">#&gt;     40        0.4019             nan     0.1000   -0.0001</span></span>
<span><span class="co">#&gt;     50        0.3766             nan     0.1000   -0.0005</span></span>
<span><span class="co">#&gt; Loading required package: pROC</span></span>
<span><span class="co">#&gt; Type 'citation("pROC")' for a citation.</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Attaching package: 'pROC'</span></span>
<span><span class="co">#&gt; The following objects are masked from 'package:stats':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     cov, smooth, var</span></span>
<span><span class="co">#&gt; Loading required package: PRROC</span></span>
<span><span class="co">#&gt; Loading required package: ModelMetrics</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Attaching package: 'ModelMetrics'</span></span>
<span><span class="co">#&gt; The following object is masked from 'package:pROC':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     auc</span></span>
<span><span class="co">#&gt; The following objects are masked from 'package:caret':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     confusionMatrix, precision, recall, sensitivity, specificity</span></span>
<span><span class="co">#&gt; The following object is masked from 'package:base':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     kappa</span></span>
<span><span class="co">#&gt; Setting levels: control = N, case = Y</span></span>
<span><span class="co">#&gt; Setting direction: controls &lt; cases</span></span>
<span><span class="co">#&gt; Preparation of a new explainer is initiated</span></span>
<span><span class="co">#&gt;   -&gt; model label       :  gbm </span></span>
<span><span class="co">#&gt;   -&gt; data              :  819  rows  205  cols </span></span>
<span><span class="co">#&gt;   -&gt; target variable   :  0  values </span></span>
<span><span class="co">#&gt;   -&gt; target variable   :  length of 'y' is different than number of rows in 'data' (  WARNING  ) </span></span>
<span><span class="co">#&gt;   -&gt; predict function  :  yhat.train  will be used (  default  )</span></span>
<span><span class="co">#&gt;   -&gt; predicted values  :  No value for predict function target column. (  default  )</span></span>
<span><span class="co">#&gt;   -&gt; model_info        :  package caret , ver. 6.0.94 , task classification (  default  ) </span></span>
<span><span class="co">#&gt;   -&gt; predicted values  :  numerical, min =  0.01284239 , mean =  0.2730344 , max =  0.9780172  </span></span>
<span><span class="co">#&gt;   -&gt; residual function :  difference between y and yhat (  default  )</span></span>
<span><span class="co">#&gt;   -&gt; residuals         :  numerical, min =  Inf , mean =  NaN , max =  -Inf  </span></span>
<span><span class="co">#&gt;   A new explainer has been created!</span></span></code></pre></div>
<p>try <code><a href="../reference/mlearn.html">?mlho::mlearn</a></code> to learn more about
<code>mlearn</code> parameters.</p>
<p>you can select a variety of models. For binray classification tasks,
chose from:ORFlog, RRF,gbm,bayesglm,regLogistic,xgbDART,regLogistic,
glmnet, bayesglm, nb, svmRadialWeights,avNNet,and ordinalRF. see the
list and description of all available <a href="https://rdrr.io/cran/caret/man/models.html" class="external-link">models</a></p>
</div>
<div class="section level2">
<h2 id="mlearn-outputs">
<code>mlearn</code> outputs<a class="anchor" aria-label="anchor" href="#mlearn-outputs"></a>
</h2>
<p>outputs of <code>mlearn</code> include:</p>
<ul>
<li>model performance metrics: <code>model.test$ROC</code>
<ul>
<li>in model.test AUROC is 0.9430716</li>
</ul>
</li>
<li>final important features, which can be pulled and save from
<code>model.test$features</code>
</li>
<li>absolute errors for each patients using
<code>model.test$AE</code>
</li>
<li>missing important features
<code>model.test$missing.features</code>
</li>
<li>SHAP values <code>model.test$shap</code>
</li>
</ul>
<p>For instance, only the following 44 features were used in phenotyping
the <code>prediabetes</code>:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">model.test</span><span class="op">$</span><span class="va">features</span></span>
<span><span class="co">#&gt;         Overall  features classifier         aoi</span></span>
<span><span class="co">#&gt; 3     0.4752894 117015009        gbm prediabetes</span></span>
<span><span class="co">#&gt; 4     0.1306988 195662009        gbm prediabetes</span></span>
<span><span class="co">#&gt; 5     2.1589882 430193006        gbm prediabetes</span></span>
<span><span class="co">#&gt; 9     3.4741224  73761001        gbm prediabetes</span></span>
<span><span class="co">#&gt; 16    0.2178041    197604        gbm prediabetes</span></span>
<span><span class="co">#&gt; 17    1.6628767    314231        gbm prediabetes</span></span>
<span><span class="co">#&gt; 20    0.6286004  40055000        gbm prediabetes</span></span>
<span><span class="co">#&gt; 24  100.0000000 271737000        gbm prediabetes</span></span>
<span><span class="co">#&gt; 26    0.1185982    746030        gbm prediabetes</span></span>
<span><span class="co">#&gt; 27    1.6202737  44054006        gbm prediabetes</span></span>
<span><span class="co">#&gt; 28    0.1909793  68496003        gbm prediabetes</span></span>
<span><span class="co">#&gt; 31    0.7985179 237602007        gbm prediabetes</span></span>
<span><span class="co">#&gt; 43    0.1562526    309362        gbm prediabetes</span></span>
<span><span class="co">#&gt; 46    3.9898824    860975        gbm prediabetes</span></span>
<span><span class="co">#&gt; 47    0.1673292    896209        gbm prediabetes</span></span>
<span><span class="co">#&gt; 48    0.4945400   2001499        gbm prediabetes</span></span>
<span><span class="co">#&gt; 49    5.2719658  19169002        gbm prediabetes</span></span>
<span><span class="co">#&gt; 51    0.1556864  80394007        gbm prediabetes</span></span>
<span><span class="co">#&gt; 52    0.4099449 127013003        gbm prediabetes</span></span>
<span><span class="co">#&gt; 55    0.5943880 410429000        gbm prediabetes</span></span>
<span><span class="co">#&gt; 57    0.8274054 431855005        gbm prediabetes</span></span>
<span><span class="co">#&gt; 73    1.8495940   5880005        gbm prediabetes</span></span>
<span><span class="co">#&gt; 75    1.4886045  28163009        gbm prediabetes</span></span>
<span><span class="co">#&gt; 79    0.6398183  60027007        gbm prediabetes</span></span>
<span><span class="co">#&gt; 80    0.1326569  62106007        gbm prediabetes</span></span>
<span><span class="co">#&gt; 84    0.3619703 104091002        gbm prediabetes</span></span>
<span><span class="co">#&gt; 91    1.3196865 169230002        gbm prediabetes</span></span>
<span><span class="co">#&gt; 93    0.2963696 171207006        gbm prediabetes</span></span>
<span><span class="co">#&gt; 94    1.1575903 225158009        gbm prediabetes</span></span>
<span><span class="co">#&gt; 97    0.4409527 268556000        gbm prediabetes</span></span>
<span><span class="co">#&gt; 109   0.1463470 237001001        gbm prediabetes</span></span>
<span><span class="co">#&gt; 111   1.7010120  14768001        gbm prediabetes</span></span>
<span><span class="co">#&gt; 114   0.1176679    429503        gbm prediabetes</span></span>
<span><span class="co">#&gt; 116   0.5612116    849574        gbm prediabetes</span></span>
<span><span class="co">#&gt; 118   0.3265564 312681000        gbm prediabetes</span></span>
<span><span class="co">#&gt; 119   0.2292650    904419        gbm prediabetes</span></span>
<span><span class="co">#&gt; 120   0.2666521  64859006        gbm prediabetes</span></span>
<span><span class="co">#&gt; 126   0.4765346 230690007        gbm prediabetes</span></span>
<span><span class="co">#&gt; 127   0.3205095 239873007        gbm prediabetes</span></span>
<span><span class="co">#&gt; 128   0.1512415    807283        gbm prediabetes</span></span>
<span><span class="co">#&gt; 143   1.2812172    310325        gbm prediabetes</span></span>
<span><span class="co">#&gt; 153   0.8604337    895994        gbm prediabetes</span></span>
<span><span class="co">#&gt; 155   1.3812208    999967        gbm prediabetes</span></span>
<span><span class="co">#&gt; 204   0.9976458    sex_cd        gbm prediabetes</span></span></code></pre></div>
<p><em>we recommend iterating the training and testing and storing the
coefficients in a directory.</em></p>
</div>
<div class="section level2">
<h2 id="visualizing-the-outputs">Visualizing the outputs<a class="anchor" aria-label="anchor" href="#visualizing-the-outputs"></a>
</h2>
<p>Here we create a plot of the feature importance scores for each of
the top (here we have ) predictors identified by MLHO.</p>
<p>To do so, let’s map the concept codes to their “English” translation.
<em>That’s why we kept that 4th column called <code>description</code>
in <code>dbmart</code>.</em></p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dbmart.concepts</span> <span class="op">&lt;-</span> <span class="va">dbmart</span><span class="op">[</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/duplicated.html" class="external-link">duplicated</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">dbmart</span><span class="op">$</span><span class="va">phenx</span><span class="op">)</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"phenx"</span>,<span class="st">"DESCRIPTION"</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="va">mlho.features</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/merge.html" class="external-link">merge</a></span><span class="op">(</span><span class="va">model.test</span><span class="op">$</span><span class="va">features</span>,<span class="va">dbmart.concepts</span>,by.x<span class="op">=</span><span class="st">"features"</span>,by.y <span class="op">=</span> <span class="st">"phenx"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu">datatable</span><span class="op">(</span><span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">mlho.features</span>,<span class="va">features</span>,<span class="va">DESCRIPTION</span>,`Feature importance`<span class="op">=</span><span class="va">Overall</span><span class="op">)</span>, options <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>pageLength <span class="op">=</span> <span class="fl">5</span><span class="op">)</span>, filter <span class="op">=</span> <span class="st">'bottom'</span><span class="op">)</span></span></code></pre></div>
<div class="datatables html-widget html-fill-item" id="htmlwidget-fb4e05cbb451a5c039f1" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-fb4e05cbb451a5c039f1">{"x":{"filter":"bottom","vertical":false,"filterHTML":"<tr>\n  <td><\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"0.117667947840181\" data-max=\"100\" data-scale=\"15\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n<\/tr>","data":[["1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17","18","19","20","21","22","23","24","25","26","27","28","29","30","31","32","33","34","35","36","37","38","39","40","41","42","43"],["104091002","117015009","127013003","14768001","169230002","171207006","19169002","195662009","197604","2001499","225158009","230690007","237001001","237602007","239873007","268556000","271737000","28163009","309362","310325","312681000","314231","40055000","410429000","429503","430193006","431855005","44054006","5880005","60027007","62106007","64859006","68496003","73761001","746030","80394007","807283","849574","860975","895994","896209","904419","999967"],["Hemoglobin / Hematocrit / Platelet count","Throat culture (procedure)","Diabetic renal disease (disorder)","Peripheral blood smear interpretation","Ultrasound scan for fetal viability","Depression screening","Miscarriage in first trimester","Acute viral pharyngitis (disorder)","Digoxin 0.125 MG Oral Tablet","Vitamin B 12 5 MG/ML Injectable Solution","Auscultation of the fetal heart","Stroke","Augmentation of labor","Metabolic syndrome X (disorder)","Osteoarthritis of knee","Urine screening for glucose","Anemia (disorder)","Skin test for tuberculosis","Clopidogrel 75 MG Oral Tablet","ferrous sulfate 325 MG Oral Tablet","Bone density scan (procedure)","Simvastatin 10 MG Oral Tablet","Chronic sinusitis (disorder)","Cardiac Arrest","Hydrochlorothiazide 12.5 MG","Medication Reconciliation (procedure)","Chronic kidney disease stage 1 (disorder)","Diabetes","Physical examination of mother","X-ray or wrist","Concussion with no loss of consciousness","Osteoporosis (disorder)","Polyp of colon","Colonoscopy","Atenolol 50 MG / Chlorthalidone 25 MG Oral Tablet","Hyperglycemia (disorder)","Mirena 52 MG Intrauterine System","Naproxen sodium 220 MG Oral Tablet","24 HR Metformin hydrochloride 500 MG Extended Release Oral Tablet","120 ACTUAT Fluticasone propionate 0.044 MG/ACTUAT Metered Dose Inhaler","60 ACTUAT Fluticasone propionate 0.25 MG/ACTUAT / salmeterol 0.05 MG/ACTUAT Dry Powder Inhaler","Alendronic acid 10 MG Oral Tablet","amLODIPine 5 MG / Hydrochlorothiazide 12.5 MG / Olmesartan medoxomil 20 MG Oral Tablet"],[0.3619703448905743,0.4752894480580893,0.4099448825848377,1.701012036870587,1.319686485532369,0.2963696287188461,5.271965807753558,0.1306987869850784,0.217804063890602,0.4945399830038691,1.157590321276218,0.4765346102160417,0.1463470430929807,0.7985178785533162,0.3205094942231865,0.440952668819013,100,1.48860450637566,0.156252635915269,1.281217249066967,0.3265564217570568,1.662876749911647,0.6286004015444601,0.5943879763314812,0.1176679478401814,2.158988204888179,0.8274054350293242,1.62027366431026,1.849594021458372,0.6398183262191786,0.1326569065854366,0.2666520789242424,0.190979314797968,3.474122437033508,0.1185982356675411,0.155686401140169,0.1512414984648714,0.5612116309612875,3.989882403659849,0.8604336662928145,0.1673292129750506,0.2292650259043822,1.381220830913898]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>features<\/th>\n      <th>DESCRIPTION<\/th>\n      <th>Feature importance<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":5,"columnDefs":[{"className":"dt-right","targets":3},{"orderable":false,"targets":0},{"name":" ","targets":0},{"name":"features","targets":1},{"name":"DESCRIPTION","targets":2},{"name":"Feature importance","targets":3}],"order":[],"autoWidth":false,"orderClasses":false,"lengthMenu":[5,10,25,50,100]},"selection":{"mode":"multiple","selected":null,"target":"row","selectable":null}},"evals":[],"jsHooks":[]}</script><p>now visualizing feature importance</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="op">(</span><span class="va">plot</span><span class="op">&lt;-</span> <span class="fu">ggplot</span><span class="op">(</span><span class="va">mlho.features</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">geom_segment</span><span class="op">(</span></span>
<span>      <span class="fu">aes</span><span class="op">(</span>y <span class="op">=</span> <span class="fl">0</span>,</span>
<span>          x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/reorder.factor.html" class="external-link">reorder</a></span><span class="op">(</span><span class="va">DESCRIPTION</span>,<span class="va">Overall</span><span class="op">)</span>,</span>
<span>          yend <span class="op">=</span> <span class="va">Overall</span>,</span>
<span>          xend <span class="op">=</span> <span class="va">DESCRIPTION</span><span class="op">)</span>,</span>
<span>      size<span class="op">=</span><span class="fl">0.5</span>,alpha<span class="op">=</span><span class="fl">0.5</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">geom_point</span><span class="op">(</span></span>
<span>      <span class="fu">aes</span><span class="op">(</span>x<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/stats/reorder.factor.html" class="external-link">reorder</a></span><span class="op">(</span><span class="va">DESCRIPTION</span>,<span class="va">Overall</span><span class="op">)</span>,y<span class="op">=</span><span class="va">Overall</span><span class="op">)</span>,</span>
<span>      alpha<span class="op">=</span><span class="fl">0.5</span>,size<span class="op">=</span><span class="fl">2</span>,color<span class="op">=</span><span class="st">"red"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">theme_minimal</span><span class="op">(</span><span class="op">)</span><span class="op">+</span></span>
<span>   <span class="fu">coord_flip</span><span class="op">(</span><span class="op">)</span><span class="op">+</span></span>
<span>    <span class="fu">labs</span><span class="op">(</span>y<span class="op">=</span><span class="st">"Feature importance"</span>,x<span class="op">=</span><span class="st">""</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning: Using `size` aesthetic for lines was deprecated in ggplot2 3.4.0.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> Please use `linewidth` instead.</span></span>
<span><span class="co">#&gt; <span style="color: #555555;">This warning is displayed once every 8 hours.</span></span></span>
<span><span class="co">#&gt; <span style="color: #555555;">Call `lifecycle::last_lifecycle_warnings()` to see where this warning was</span></span></span>
<span><span class="co">#&gt; <span style="color: #555555;">generated.</span></span></span></code></pre></div>
<p><img src="MLHO_Vanilla_files/figure-html/unnamed-chunk-11-1.png" width="672" style="display: block; margin: auto;"></p>
</div>
<div class="section level2">
<h2 id="shap-value-and-visualization">SHAP value and visualization<a class="anchor" aria-label="anchor" href="#shap-value-and-visualization"></a>
</h2>
<p>When setting <code>calSHAP=TRUE</code>, SHAP values are also
calculated to explain the output of models as shown below.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">shap_value</span> <span class="op">&lt;-</span> <span class="va">model.test</span><span class="op">$</span><span class="va">shap</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="va">shap_value</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt;                variable contribution variable_name variable_value sign label B</span></span>
<span><span class="co">#&gt; 1000126     1000126 = 0  0.000000000       1000126              0    0   gbm 0</span></span>
<span><span class="co">#&gt; 10383002   10383002 = 0  0.000000000      10383002              0    0   gbm 0</span></span>
<span><span class="co">#&gt; 104091002 104091002 = 2 -0.001611318     104091002              2   -1   gbm 0</span></span>
<span><span class="co">#&gt; 104326007 104326007 = 1  0.000000000     104326007              1    0   gbm 0</span></span>
<span><span class="co">#&gt; 104375008 104375008 = 1  0.000000000     104375008              1    0   gbm 0</span></span>
<span><span class="co">#&gt; 104435004 104435004 = 0  0.000000000     104435004              0    0   gbm 0</span></span></code></pre></div>
<p>Using the default plot function, the feature importance are shown
below.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># shap_value &lt;- data.frame(merge(shap_value,dbmart.concepts,by.x="variable_name",by.y = "phenx"))</span></span>
<span><span class="co"># shap_value &lt;- shap_value %&gt;% select(-variable)</span></span>
<span><span class="co"># names(shap_value)[names(shap_value) == 'DESCRIPTION'] &lt;- 'variable'</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">shap_value</span>, max_features<span class="op">=</span> <span class="fl">20</span><span class="op">)</span></span></code></pre></div>
<p><img src="MLHO_Vanilla_files/figure-html/unnamed-chunk-13-1.png" width="700"></p>
</div>
<div class="section level2">
<h2 id="notes-for-more-complex-implementation">Notes for more complex implementation<a class="anchor" aria-label="anchor" href="#notes-for-more-complex-implementation"></a>
</h2>
<p>As we recommended above, it’s best to at least iterate the training
process 5 times, in which case you’ll have 5 files containing the
important features from MLHO. We do this regularly. If you do so, you
can compute the mean/median values for each feature.</p>
<p>Now if you want to get the regression coefficients and compute Odds
Ratios (ORs), you can then select the top feature that were selected
most frequently in MLHO iterations to run a regression model (pass
<code>glm</code> to <code>mlearn</code>) and extract regression
coefficients to then transform to ORs.</p>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Hossein Estiri.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
